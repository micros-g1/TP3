/******************************************************************************
  @file     App.c
  @brief    Application functions
  @author	Grupo 1 - Labo de Micros 2019
 ******************************************************************************/

/*******************************************************************************
 * INCLUDE HEADER FILES
 ******************************************************************************/

#include "DAC/dac_driver.h"
#include "math.h"

/*******************************************************************************
 * CONSTANT AND MACRO DEFINITIONS USING #DEFINE
 ******************************************************************************/
#define M_PI 3.14159265358979323846
/******************************************************************************
 * FUNCTION PROTOTYPES FOR PRIVATE FUNCTIONS WITH FILE LEVEL SCOPE
 ******************************************************************************/
static void delayLoop(uint32_t veces);
int min(int x, int y);
/*******************************************************************************
 *******************************************************************************
                        GLOBAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/

uint16_t value;

/* Funci√≥n que se llama una vez, al comienzo del programa */
void App_Init (void)
{
	/* DAC TEST */
	dac_init();
	dac_setup_buffer(DAC_BUFFER_NORMAL);
	double h = M_PI/DAC_BUFFER_SIZE;
	for (int i = 0; i < DAC_BUFFER_SIZE; i++){
		double f_val = sin(h*i);
		uint16_t q_val = (uint16_t)(min(4095, (int)(f_val * 4096.0)));
		dac_write_to_buffer(i, q_val);
	}
	dac_trigger_select(DAC_SOFTWARE_TRIGGER);
	dac_enable(true);
}


void App_Run (void)
{
	dac_trigger();
	delayLoop(1000000U);
}

/*******************************************************************************
 *******************************************************************************
                        LOCAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/
static void delayLoop(uint32_t veces)
{
    while (veces--);
}

int min(int x, int y){
  return (x < y) ? x : y;
}

/*******************************************************************************
 ******************************************************************************/
